version: '3.9'

services:
  frontend:
    extends:
      file: docker-compose.yml
      service: frontend
    environment:
      - VITE_API_URL=https://api.example.com

  backend:
    extends:
      file: docker-compose.yml
      service: backend
    environment:
      - ENVIRONMENT=production
      - DEBUG=false

  postgres:
    extends:
      file: docker-compose.yml
      service: postgres
    environment:
      - POSTGRES_PASSWORD_FILE=/run/secrets/postgres_password
    secrets:
      - postgres_password

  redis:
    extends:
      file: docker-compose.yml
      service: redis
    command: ["/bin/sh", "/start-redis.sh"]
    volumes:
      - ./start-redis.sh:/start-redis.sh:ro
    secrets:
      - redis_password

secrets:
  postgres_password:
    file: ./secrets/postgres_password.txt
  redis_password:
    file: ./secrets/redis_password.txt
