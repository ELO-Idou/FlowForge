{
  "messages": [
    {
      "id": "1",
      "role": "user",
      "content": "Create a complete Nuki Smart Lock Customer Service Full Automation workflow for n8n with these requirements:\n\n## WORKFLOW STRUCTURE:\n1. **Webhook Trigger** - Receives incoming support tickets from Zendesk/Freshdesk with POST data containing: ticket_id, customer_email, subject, description, priority\n\n2. **Extract Ticket Data** - Use Set node (v3.3) to normalize the webhook data into clean fields: ticket_id, customer_name, customer_email, issue_description, priority_level\n\n3. **AI Issue Analysis** - Use Code node (v2) with complete JavaScript that:\n   - Analyzes the issue_description text\n   - Detects categories: motor_blocked, battery_low, calibration_failed, bluetooth_pairing, bridge_offline, firmware_update, door_sensor, app_connectivity\n   - Extracts product model if mentioned (Nuki Smart Lock 3.0 Pro, Nuki Smart Lock 2.0, Nuki Opener)\n   - Calculates urgency score (1-10) based on keywords like 'locked out', 'emergency', 'broken', 'urgent'\n   - Returns: {category, product_model, urgency_score, keywords_found, confidence}\n\n4. **Check Urgency Level** - Switch node (v3.1) that routes based on urgency_score:\n   - Output 0: urgency_score >= 8 (Emergency - immediate human escalation)\n   - Output 1: urgency_score >= 5 (High priority - automated solution + human review)\n   - Output 2: urgency_score < 5 (Standard - fully automated)\n\n5. **Emergency Path** (for Output 0):\n   - HTTP Request node (v4.2) to Slack webhook API posting: {channel: '#support-emergency', text: 'URGENT: Customer locked out', ticket_id, customer_email}\n   - Set node creating escalation response: {status: 'escalated', assigned_to: 'senior_support', eta_minutes: 15}\n\n6. **Automated Solution Path** (for Output 2):\n   - Switch node (v3.1) routing by category field with 8 outputs (one per category)\n   - For each category, create a Set node (v3.3) with detailed troubleshooting:\n     * motor_blocked: Step-by-step motor reset, calibration guide, obstruction check, video tutorial link\n     * battery_low: Battery type recommendation, replacement guide, calibration after replacement, where to buy link\n     * calibration_failed: Complete recalibration procedure, door alignment tips, common mistakes, reset instructions\n     * bluetooth_pairing: Phone settings check, Nuki app reinstall steps, clearing Bluetooth cache, pairing mode activation\n     * bridge_offline: Network diagnostics, Bridge restart procedure, router settings, firmware check\n     * firmware_update: Safe update instructions, backup recommendations, troubleshooting failed updates\n     * door_sensor: Sensor alignment guide, magnet positioning, testing procedure\n     * app_connectivity: Account verification, app permissions, reinstall guide, server status check\n\n7. **Generate Response Email** - Code node (v2) with JavaScript that:\n   - Takes the troubleshooting steps from previous node\n   - Formats HTML email with: personalized greeting, issue summary, numbered steps with icons, helpful tips section, video tutorial embeds, contact support footer\n   - Returns: {email_html, email_subject, email_plain_text}\n\n8. **Send Email** - HTTP Request node (v4.2) to SendGrid/Mailgun API:\n   - Method: POST\n   - Headers: Authorization with API key, Content-Type: application/json\n   - Body: {to: customer_email, from: 'support@nuki.io', subject: email_subject, html: email_html}\n\n9. **Update Ticket Status** - HTTP Request node (v4.2) back to ticketing system:\n   - Method: PUT to /api/tickets/{{ticket_id}}\n   - Body: {status: 'solved', internal_note: 'Auto-resolved with category: {{category}}', resolution_time_seconds: 45}\n\n10. **Log to Database** - HTTP Request node (v4.2) or Postgres node to log:\n    - ticket_id, category, urgency_score, resolution_type (auto/escalated), timestamp, customer_satisfaction (pending)\n\n11. **Schedule Follow-up** - Set node creating a 24-hour follow-up task:\n    - Trigger: webhook callback after 24h\n    - Action: Send satisfaction survey email\n    - Data: {ticket_id, customer_email, resolution_category, survey_link}\n\n## REQUIREMENTS:\n- Use EXACT node types: n8n-nodes-base.webhook, n8n-nodes-base.set, n8n-nodes-base.code, n8n-nodes-base.switch, n8n-nodes-base.httpRequest\n- Include EXACT typeVersion for each node\n- Write COMPLETE executable JavaScript code (not pseudocode) for all Code nodes with proper error handling\n- Create DETAILED switch conditions with exact JSON path expressions like ={{$json.urgency_score}}\n- Include FULL parameter objects for HTTP Request nodes (url, method, headers, body, authentication)\n- Provide COMPLETE troubleshooting text (minimum 4-5 steps per category)\n- Add proper node positions for visual layout\n- Include ALL edge connections with correct source/target node IDs\n- Make it production-ready - no placeholders or TODO comments\n\nGenerate the complete workflow JSON now."
    }
  ]
}
